{% extends "base.html" %}

{% block title %}New Consultation - {{ patient.name }}{% endblock %}

{% block content %}
<div class="card">
    <h2>üìã Consultation - {{ patient.name }} ({{ patient.age }}Y/{{ patient.gender }})</h2>
    <p>Phone: {{ patient.phone }} | Patient ID: {{ patient.patient_id }}</p>
    
    {% if patient.allergies %}
    <div style="margin: 15px 0; padding: 10px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
        <strong>‚ö†Ô∏è Allergies:</strong> {{ patient.allergies }}
    </div>
    {% endif %}
    
    <form method="POST">
        <h3 style="margin-top: 20px; color: #667eea;">Vitals</h3>
        <div class="form-row">
            <div class="form-group">
                <label for="bp_systolic">Blood Pressure (Systolic)</label>
                <input type="number" id="bp_systolic" name="bp_systolic" placeholder="120">
            </div>
            
            <div class="form-group">
                <label for="bp_diastolic">Blood Pressure (Diastolic)</label>
                <input type="number" id="bp_diastolic" name="bp_diastolic" placeholder="80">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="pulse">Pulse (bpm)</label>
                <input type="number" id="pulse" name="pulse" placeholder="72">
            </div>
            
            <div class="form-group">
                <label for="temperature">Temperature (¬∞F)</label>
                <input type="number" step="0.1" id="temperature" name="temperature" placeholder="98.4">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="weight">Weight (kg)</label>
                <input type="number" step="0.1" id="weight" name="weight" placeholder="65.5">
            </div>
            
            <div class="form-group">
                <label for="height">Height (cm)</label>
                <input type="number" step="0.1" id="height" name="height" placeholder="170">
            </div>
        </div>
        
        <h3 style="margin-top: 20px; color: #667eea;">Consultation Details</h3>
        <div class="form-group">
            <label for="chief_complaint">Chief Complaint *</label>
            <textarea id="chief_complaint" name="chief_complaint" required 
                      placeholder="E.g., Fever for 3 days, Body ache, Headache"></textarea>
        </div>
        
        <div class="form-group">
            <label for="diagnosis">Diagnosis *</label>
            <input type="text" id="diagnosis" name="diagnosis" required
                   placeholder="E.g., Viral Fever, Upper Respiratory Tract Infection">
        </div>
        
        <div class="form-group">
            <label for="prescription">Prescription</label>
            <textarea id="prescription" name="prescription" style="min-height: 150px;"
                      placeholder="Medicine details (one per line):
Example:
1. Paracetamol 650mg - 1-0-1 - 5 days - After food
2. Cetrizine 10mg - 0-0-1 - 3 days - After food"></textarea>
        </div>
        
        <div class="form-group">
            <label for="investigation">Tests/Investigation</label>
            <textarea id="investigation" name="investigation"
                      placeholder="E.g., CBC, Blood Sugar, X-Ray, ECG"></textarea>
        </div>
        
        <div class="form-group">
            <label for="treatment_plan">Treatment Plan / Advice</label>
            <textarea id="treatment_plan" name="treatment_plan"
                      placeholder="E.g., Rest, Drink plenty of fluids, Avoid cold food"></textarea>
        </div>
        
        <div class="form-group">
            <label for="follow_up_date">Follow-up Date (if needed)</label>
            <input type="date" id="follow_up_date" name="follow_up_date">
        </div>
        
        <h3 style="margin-top: 20px; color: #667eea;">Billing</h3>
        <div class="form-row">
            <div class="form-group">
                <label for="consultation_fee">Consultation Fee</label>
                <input type="number" id="consultation_fee" name="consultation_fee" 
                       value="{{ consultation_fee }}" readonly style="background: #f8f9fa;">
            </div>
            
            <div class="form-group">
                <label for="payment_status">Payment Status *</label>
                <select id="payment_status" name="payment_status" required>
                    <option value="paid">Paid</option>
                    <option value="unpaid">Unpaid</option>
                </select>
            </div>
        </div>
        
        <div class="form-group" id="payment_method_group" style="display: block;">
            <label for="payment_method">Payment Method</label>
            <select id="payment_method" name="payment_method">
                <option value="cash">Cash</option>
                <option value="card">Card</option>
                <option value="upi">UPI</option>
            </select>
        </div>
        
        <div style="margin-top: 30px;">
            <button type="submit" class="btn">üíæ Save & View Prescription</button>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
    // Show/hide payment method based on payment status
    document.getElementById('payment_status').addEventListener('change', function() {
        const paymentMethodGroup = document.getElementById('payment_method_group');
        if (this.value === 'paid') {
            paymentMethodGroup.style.display = 'block';
        } else {
            paymentMethodGroup.style.display = 'none';
        }
    });
</script>
{% endblock %}


